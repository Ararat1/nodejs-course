<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Admin panel</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            rel="stylesheet"
            href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
            integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-expand-md bg-dark navbar-dark">
            <a class="navbar-brand" href="/">Home</a>
            <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#collapsibleNavbar"
            >
                <span class="navbar-toggler-icon"></span>
            </button>
            <div
                class="collapse navbar-collapse justify-content-end"
                id="collapsibleNavbar"
            >
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/login">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/register">Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/auth/logout">Logout</a>
                    </li>
                </ul>
            </div>
        </nav>
        <br />
        <div class="container">
            <div class="row">
                <div class="col-12 text-right">
                    <a href="/admin/new-article" class="btn btn-success">
                        Add a new article
                    </a>
                </div>
                <div class="col-12 mt-4">
                    <table class="table table-striped" id="articles">
                        <tbody>
                            <% articles.forEach(({_id,title,description,content,image}) => { %>
                            <tr>
                                <td>
                                    <img
                                        src="/images/<%= image %>"
                                        alt="article-image"
                                        width="40"
                                        height="25"
                                    />
                                </td>
                                <td><strong><%= title %></strong></td>
                                <td><%= description %></td>
                                <td><%= content.slice(0,50) %>...</td>
                                <td>
                                    <a
                                        href="/admin/read/<%= _id %>"
                                        class="btn btn-primary btn-sm"
                                    >
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </td>
                                <td>
                                    <a
                                        href="/admin/update/<%= _id %>"
                                        class="btn btn-warning btn-sm"
                                    >
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                                <td>
                                    <button
                                        class="btn btn-danger btn-sm"
                                        id="<%= _id %>"
                                        data-role="delete"
                                    >
                                        <i
                                            class="fas fa-trash-alt"
                                            id="<%= _id %>"
                                            data-role="delete"
                                        ></i>
                                    </button>
                                </td>
                            </tr>
                            <% })%>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            let articlesTable = document.querySelector("table#articles");

            articlesTable.addEventListener("click", ({ target }) => {
                if (target.tagName !== "BUTTON" && target.tagName !== "I") {
                    return;
                }

                if (target.dataset.role !== "delete") {
                    return;
                }

                fetch(`http://localhost:8080/admin/delete/${target.id}`)
                    .then(() => location.reload())
                    .catch(({ message }) => {
                        console.log("Delete error: ", message);
                    });
            });
        </script>
    </body>
</html>
